---
import Base from '../layouts/Base.astro';
import CategoryCard from '../components/CategoryCard.astro';
import EntryCard from '../components/EntryCard.astro';
import { getCollection } from 'astro:content';

const categories = [
  { name: 'archaeology', slug: 'archaeology', code: 'ARCH', description: 'history.lineages.deprecated_systems' },
  { name: 'anatomy', slug: 'anatomy', code: 'ANAT', description: 'architecture.memory.compute' },
  { name: 'taxonomy', slug: 'taxonomy', code: 'TAXO', description: 'classification.autonomy.specialization' },
  { name: 'ethology', slug: 'ethology', code: 'ETHO', description: 'behaviors.patterns.failure_modes' },
  { name: 'linguistics', slug: 'linguistics', code: 'LING', description: 'prompts.dialects.protocols' },
  { name: 'sociology', slug: 'sociology', code: 'SOCI', description: 'multi-agent.hierarchies.coordination' },
  { name: 'ecology', slug: 'ecology', code: 'ECOL', description: 'environments.niches.threats' },
  { name: 'ethics', slug: 'ethics', code: 'ETHI', description: 'alignment.governance.constraints' },
];

const allEntries = await getCollection('entries');
const publishedEntries = allEntries
  .filter(entry => entry.data.status === 'published')
  .sort((a, b) => (b.data.date?.getTime() || 0) - (a.data.date?.getTime() || 0))
  .slice(0, 5);

// Count entries per category
const categoryCounts = categories.map(cat => ({
  ...cat,
  count: allEntries.filter(e => e.data.category === cat.slug).length
}));
---

<Base title="AGENTOLOGY">
  <!-- Terminal Header -->
  <header class="mb-12 border-b border-border-primary pb-6 scan-line">
    <pre class="text-text-muted text-xs mb-4 font-mono animate-fade-in">
┌─────────────────────────────────────────────────────────────┐
│ AGENTOLOGY RESEARCH TERMINAL v1.0                           │
│ classified // anthropological framework for autonomous AI    │
└─────────────────────────────────────────────────────────────┘
    </pre>
    <div class="space-y-1 text-xs font-mono">
      <p class="text-text-muted animate-fade-in" style="animation-delay: 0.2s">
        > initializing database...
      </p>
      <p class="text-text-muted animate-fade-in" style="animation-delay: 0.4s">
        > loading taxonomic framework...
      </p>
      <p class="text-text-primary animate-fade-in" style="animation-delay: 0.6s">
        > system ready<span class="animate-blink">.</span> {allEntries.length} entries indexed.
      </p>
    </div>
  </header>

  <!-- Categories -->
  <section class="mb-12">
    <h2 class="text-sm font-mono text-text-primary mb-4 uppercase tracking-wider animate-fade-in">
      [ classification.system ]
    </h2>
    <div class="space-y-1 text-xs">
      {categoryCounts.map((cat, index) => (
        <a
          href={`/taxonomy?category=${cat.slug}`}
          class="block px-3 py-2 border border-border-primary hover:border-text-primary hover:bg-bg-secondary transition-all group animate-slide-in"
          style={`animation-delay: ${(index + 1) * 80}ms`}
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-text-muted font-mono">{cat.code}</span>
              <span class="text-text-muted group-hover:text-text-primary font-mono transition-colors">{cat.name}</span>
            </div>
            <span class="text-text-muted font-mono">[{cat.count}]</span>
          </div>
          <div class="text-text-muted font-mono mt-0.5 pl-12 opacity-70">
            {cat.description}
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- Recent Entries -->
  {publishedEntries.length > 0 && (
    <section class="mb-12">
      <h2 class="text-sm font-mono text-text-primary mb-4 uppercase tracking-wider animate-fade-in">
        [ recent.entries ]
      </h2>
      <div class="space-y-1">
        {publishedEntries.map((entry, index) => (
          <a
            href={`/entries/${entry.slug}`}
            class="block px-3 py-2 border border-border-primary hover:border-text-primary hover:bg-bg-secondary transition-all animate-slide-in"
            style={`animation-delay: ${(index + 10) * 50}ms`}
          >
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1">
                <div class="text-xs font-mono text-text-secondary mb-0.5">
                  {entry.data.title}
                </div>
                <div class="text-xs text-text-muted font-mono line-clamp-1">
                  {entry.data.description}
                </div>
              </div>
              <span class="text-xs text-text-muted font-mono whitespace-nowrap">
                {entry.data.category}
              </span>
            </div>
          </a>
        ))}
      </div>
      <div class="mt-4 text-right animate-fade-in" style="animation-delay: 1s">
        <a href="/taxonomy" class="text-text-muted hover:text-text-primary font-mono text-xs border-b border-transparent hover:border-text-muted transition-all">
          view_all >>
        </a>
      </div>
    </section>
  )}

  <!-- System Info -->
  <section class="bg-bg-secondary border border-border-primary p-3 animate-fade-in" style="animation-delay: 1.2s">
    <h2 class="text-xs font-mono text-text-muted mb-2 uppercase">
      [ system.info ]
    </h2>
    <div class="text-xs text-text-muted font-mono space-y-1">
      <p>
        anthropological framework for autonomous AI
      </p>
      <p class="opacity-70">
        taxonomy // behavior // evolution
      </p>
      <div class="flex gap-4 mt-3 pt-2 border-t border-border-primary">
        <a href="/entries/agentogenesis" class="text-text-secondary hover:text-text-primary border-b border-transparent hover:border-text-muted transition-all">
          >> begin
        </a>
        <a href="/about" class="text-text-muted hover:text-text-secondary border-b border-transparent hover:border-text-muted transition-all">
          >> info
        </a>
      </div>
    </div>
  </section>
</Base>
